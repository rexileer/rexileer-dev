version: "3.9"

services:
  portfolio:
    container_name: rexileer-portfolio
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - /srv/letsencrypt-webroot:/var/www/acme:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "-O", "-", "http://127.0.0.1/"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s


  certbot:
    image: certbot/certbot
    container_name: certbot
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt
      - /srv/letsencrypt-webroot:/var/www/acme
    entrypoint: ["/bin/sh", "-c"]
    # Пример запуска (одноразово, вручную):
    # docker compose run --rm certbot \
    #   certonly --webroot -w /var/www/acme \
    #   -d rexileer.ru -d www.rexileer.ru \
    #   --agree-tos -m you@example.com --non-interactive
